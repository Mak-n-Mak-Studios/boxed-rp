<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ChetoRP: code/Util/Database/DbTransaction.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ChetoRP
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_db_transaction_8cs_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">DbTransaction.cs</div></div>
</div><!--header-->
<div class="contents">
<a href="_db_transaction_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="keyword">using</span> System;</div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="keyword">using</span> System.Threading;</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span> </div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespace_cheto_rp_1_1_database.html">ChetoRp.Database</a></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span>{</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html">    6</a></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code hl_class" href="class_cheto_rp_1_1_database_1_1_db_transaction.html">DbTransaction</a> : IDisposable</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span>    {</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a4b4bb35cfd168f686f9009035980774a">    8</a></span>        <span class="keyword">private</span> <span class="keyword">static</span> ulong <a class="code hl_variable" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a4b4bb35cfd168f686f9009035980774a">transactionCounter</a> = 0;</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a189a241fd9bcd7418ee04590c9bbbdfe">    9</a></span>        <span class="keyword">private</span> readonly <span class="keyword">static</span> ThreadLocal&lt;WeakReference&lt;DbTransaction&gt;&gt; <a class="code hl_variable" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a189a241fd9bcd7418ee04590c9bbbdfe">threadLocks</a>;</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a21f5b5b2f23ae7ed24a36cf5cadb1cce">   11</a></span>        <span class="keyword">private</span> ulong <a class="code hl_variable" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a21f5b5b2f23ae7ed24a36cf5cadb1cce">id</a>;</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#adad7a05733a157d92f153556e8ab59d8">   12</a></span>        <span class="keyword">private</span> ulong <a class="code hl_variable" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#adad7a05733a157d92f153556e8ab59d8">stepId</a>;</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span> </div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#aa3f2d472e4431e52438a646a4d4aae77">   14</a></span>        <span class="keyword">static</span> <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#aa3f2d472e4431e52438a646a4d4aae77">DbTransaction</a>()</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>        {</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>            <a class="code hl_variable" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a189a241fd9bcd7418ee04590c9bbbdfe">threadLocks</a> = <span class="keyword">new</span>( () =&gt; <span class="keyword">new</span> WeakReference&lt;DbTransaction&gt;( <span class="keyword">new</span> <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#aa3f2d472e4431e52438a646a4d4aae77">DbTransaction</a>() ) );</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>            <span class="comment">// TODO: implement WAL rollbacks</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>        }</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1fd92ea27981c2dacdc63bde3f98655b">   21</a></span>        <span class="keyword">public</span> <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1fd92ea27981c2dacdc63bde3f98655b">DbTransaction</a>()</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>        {</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>            <span class="keywordflow">if</span> ( <a class="code hl_variable" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a189a241fd9bcd7418ee04590c9bbbdfe">threadLocks</a>.Value.TryGetTarget( out _ ) )</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>            {</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException( $<span class="stringliteral">&quot;A {nameof( DbTransaction )} is currently active on this thread. It must be disposed of.&quot;</span> );</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>            }</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>            {</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>                <span class="keywordtype">id</span> = Interlocked.Increment( ref <a class="code hl_variable" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a4b4bb35cfd168f686f9009035980774a">transactionCounter</a> );</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>                <a class="code hl_variable" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a189a241fd9bcd7418ee04590c9bbbdfe">threadLocks</a>.Value.SetTarget( <span class="keyword">this</span> );</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>            }</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>        }</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a51e2565454ed4091d55375f7db3f2082">   34</a></span>        <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a51e2565454ed4091d55375f7db3f2082">~DbTransaction</a>()</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>        {</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>            <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a691edb4e6052b93d13061097c84273f1">Dispose</a>(); <span class="comment">// In case it was never called.</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>        }</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1e966815340503d62f826b9150668d3f">   39</a></span>        <span class="keyword">public</span> <a class="code hl_class" href="class_cheto_rp_1_1_database_1_1_db_transaction.html">DbTransaction</a> <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1e966815340503d62f826b9150668d3f">CreateTable</a>( <span class="keywordtype">string</span> tableName, <span class="keywordtype">bool</span> isBig = <span class="keyword">false</span> )</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>        {</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>            <span class="comment">// Log in WAL</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>            <span class="comment">// if the table doesnt exist, create the folder as some in progress folder, create the big table file if necessary. if the table exists, do nothing</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>            <span class="comment">// for secondary WAL: if table doesnt exist, create the folder and delete in progress folder. if it already exists, delete in progress folder if exists</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>            <span class="comment">// to roll back, delete the in progress folder if it exists</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>        }</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a7056bf6caa72a7dd2766663a6ef140d5">   48</a></span>        <span class="keyword">public</span> <a class="code hl_class" href="class_cheto_rp_1_1_database_1_1_db_transaction.html">DbTransaction</a> <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a7056bf6caa72a7dd2766663a6ef140d5">DropTable</a>( <span class="keywordtype">string</span> tableName )</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>        {</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>            <span class="comment">// Log in WAL</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>            <span class="comment">// rename the folder, prefix with four underscores and ensure table names can&#39;t begin with four underscores</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>            <span class="comment">// for secondary WAL:</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>            <span class="comment">//      make a folder called ________deleted (8 underscores) if it doesn&#39;t exist</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>            <span class="comment">//      move the folder prefixed with four underscores to this folder (prefix the four underscores with a random 64 bit number if it cant be moved to four underscores)</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>            <span class="comment">//      create a dedicated thread to delete files and folders within this deleted folder which can be exeecuted using a static method during a secondary WAL action and on startup</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>            <span class="comment">//      limit table names to 128 chars (enforced on creation and deletion of tbables only)</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>            <span class="comment">//      </span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>            <span class="comment">// to roll back, rename the folder back</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>        }</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span> </div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a9da3eff294366e38e1eba476873e681b">   62</a></span>        <span class="keyword">public</span> <a class="code hl_class" href="class_cheto_rp_1_1_database_1_1_db_transaction.html">DbTransaction</a> <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a9da3eff294366e38e1eba476873e681b">AddEntry&lt;T&gt;</a>( <span class="keywordtype">string</span> tableName, T entry, <a class="code hl_enumeration" href="namespace_cheto_rp_1_1_database.html#aa0b504dd3da40bdfaaafd72a2f0c4885">AddQueryType</a> operationType = <a class="code hl_enumeration" href="namespace_cheto_rp_1_1_database.html#aa0b504dd3da40bdfaaafd72a2f0c4885">AddQueryType</a>.InsertOrReplace )</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>        {</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            <span class="comment">// log in WAL</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>            <span class="comment">// if insert and file isnt present, insert to in progress file, rename current entry file, rename in progress file to entry name if file present, throw exception, which will rollback if not caught.</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>            <span class="comment">// if insertorreplace, insert to in progress file, rename current entry file, rename in progress file to entry name</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>            <span class="comment">// if replace and file is present, insert to in progress file, rename current entry file, rename in progress to entry name if file present. if file not present, throw exception which will rollabck if not caught</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>            <span class="comment">// for secondary WAL: delete old file if present</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>            <span class="comment">// to roll back, if the entry file is still present in its renamed form, then rename any file called the entry file name and rename the renamed entry file back to the entry file name and delete other file. if not present, delete any renamed entry file names.</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>        }</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1c88676ca50818153c66c03e8ffff10c">   73</a></span>        <span class="keyword">public</span> <a class="code hl_class" href="class_cheto_rp_1_1_database_1_1_db_transaction.html">DbTransaction</a> <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1c88676ca50818153c66c03e8ffff10c">RemoveEntry&lt;K&gt;</a>( <span class="keywordtype">string</span> tableName, K key, <a class="code hl_enumeration" href="namespace_cheto_rp_1_1_database.html#a7f43c437a9c94b1ea086306670612e4b">RemoveQueryType</a> operationType = <a class="code hl_enumeration" href="namespace_cheto_rp_1_1_database.html#a7f43c437a9c94b1ea086306670612e4b">RemoveQueryType</a>.RemoveIfPresent )</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>        {</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>            <span class="comment">// log in WAL</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>            <span class="comment">// if remove, rename entry file if present, giving it a different extension. otherwise throw exception.</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>            <span class="comment">// if removeifpresent, rename entry file if present, giving it a different extension. otherwise do nothing.</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>            <span class="comment">// for secondary WAL: delete renamed entry file if present</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>            <span class="comment">// to roll back, rename the rename entry file back if it&#39;s present</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        }</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a53e457ddb9f1c123bf6b9984baaa3e90">   83</a></span>        <span class="keyword">public</span> <a class="code hl_class" href="class_cheto_rp_1_1_database_1_1_db_transaction.html">DbTransaction</a> <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a53e457ddb9f1c123bf6b9984baaa3e90">GetEntryOr&lt;K, V&gt;</a>( <span class="keywordtype">string</span> tableName, K key, Action&lt;V, DbTransaction&gt; entryAction ) <span class="comment">// what to do if not exist</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        {</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            <span class="comment">// Run the action with entry gotten as V and this, which will deal with the subtransaction</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>        }</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span> </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#af67548bcb86a4434a9f2e307b64a7a20">   89</a></span>        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#af67548bcb86a4434a9f2e307b64a7a20">Commit</a>()</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>        {</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>            <span class="comment">// Write secondary WAL, rename it, delete first WAL. Execute deletions as necessary. delete secondary WAL</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span> </div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>            <span class="comment">// rollbacks should only be done prior to the secondary WAL being renamed</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            <span class="comment">// if the secondary WAL is renamed, then roll forward (?</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span> </div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>            <span class="comment">// rename secondary WAL right before each step so that a restart would resume the secondary WAL at the right step.</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>            <span class="comment">// queue deletion of ________deleted if it exists</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>        }</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1fc2b929f7d084493fe66694b9afce95">   99</a></span>        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1fc2b929f7d084493fe66694b9afce95">Cancel</a>()</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>        {</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>            <span class="comment">// Rollback changes</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>        }</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno"><a class="line" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a691edb4e6052b93d13061097c84273f1">  104</a></span>        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a691edb4e6052b93d13061097c84273f1">Dispose</a>()</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>        {</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>            <span class="comment">// check primary WAL file. if it&#39;s still here. then rollback everything and log an error</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>            <a class="code hl_variable" href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a189a241fd9bcd7418ee04590c9bbbdfe">threadLocks</a>.Value.SetTarget( <span class="keyword">null</span> );</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>        }</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    }</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>}</div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html">ChetoRp.Database.DbTransaction</a></div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00006">DbTransaction.cs:7</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a189a241fd9bcd7418ee04590c9bbbdfe"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a189a241fd9bcd7418ee04590c9bbbdfe">ChetoRp.Database.DbTransaction.threadLocks</a></div><div class="ttdeci">static readonly ThreadLocal&lt; WeakReference&lt; DbTransaction &gt; &gt; threadLocks</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00009">DbTransaction.cs:9</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a1c88676ca50818153c66c03e8ffff10c"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1c88676ca50818153c66c03e8ffff10c">ChetoRp.Database.DbTransaction.RemoveEntry&lt; K &gt;</a></div><div class="ttdeci">DbTransaction RemoveEntry&lt; K &gt;(string tableName, K key, RemoveQueryType operationType=RemoveQueryType.RemoveIfPresent)</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00073">DbTransaction.cs:73</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a1e966815340503d62f826b9150668d3f"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1e966815340503d62f826b9150668d3f">ChetoRp.Database.DbTransaction.CreateTable</a></div><div class="ttdeci">DbTransaction CreateTable(string tableName, bool isBig=false)</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00039">DbTransaction.cs:39</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a1fc2b929f7d084493fe66694b9afce95"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1fc2b929f7d084493fe66694b9afce95">ChetoRp.Database.DbTransaction.Cancel</a></div><div class="ttdeci">void Cancel()</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00099">DbTransaction.cs:99</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a1fd92ea27981c2dacdc63bde3f98655b"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a1fd92ea27981c2dacdc63bde3f98655b">ChetoRp.Database.DbTransaction.DbTransaction</a></div><div class="ttdeci">DbTransaction()</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00021">DbTransaction.cs:21</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a21f5b5b2f23ae7ed24a36cf5cadb1cce"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a21f5b5b2f23ae7ed24a36cf5cadb1cce">ChetoRp.Database.DbTransaction.id</a></div><div class="ttdeci">ulong id</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00011">DbTransaction.cs:11</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a4b4bb35cfd168f686f9009035980774a"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a4b4bb35cfd168f686f9009035980774a">ChetoRp.Database.DbTransaction.transactionCounter</a></div><div class="ttdeci">static ulong transactionCounter</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00008">DbTransaction.cs:8</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a51e2565454ed4091d55375f7db3f2082"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a51e2565454ed4091d55375f7db3f2082">ChetoRp.Database.DbTransaction.~DbTransaction</a></div><div class="ttdeci">~DbTransaction()</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00034">DbTransaction.cs:34</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a53e457ddb9f1c123bf6b9984baaa3e90"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a53e457ddb9f1c123bf6b9984baaa3e90">ChetoRp.Database.DbTransaction.GetEntryOr&lt; K, V &gt;</a></div><div class="ttdeci">DbTransaction GetEntryOr&lt; K, V &gt;(string tableName, K key, Action&lt; V, DbTransaction &gt; entryAction)</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00083">DbTransaction.cs:83</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a691edb4e6052b93d13061097c84273f1"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a691edb4e6052b93d13061097c84273f1">ChetoRp.Database.DbTransaction.Dispose</a></div><div class="ttdeci">void Dispose()</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00104">DbTransaction.cs:104</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a7056bf6caa72a7dd2766663a6ef140d5"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a7056bf6caa72a7dd2766663a6ef140d5">ChetoRp.Database.DbTransaction.DropTable</a></div><div class="ttdeci">DbTransaction DropTable(string tableName)</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00048">DbTransaction.cs:48</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_a9da3eff294366e38e1eba476873e681b"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#a9da3eff294366e38e1eba476873e681b">ChetoRp.Database.DbTransaction.AddEntry&lt; T &gt;</a></div><div class="ttdeci">DbTransaction AddEntry&lt; T &gt;(string tableName, T entry, AddQueryType operationType=AddQueryType.InsertOrReplace)</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00062">DbTransaction.cs:62</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_aa3f2d472e4431e52438a646a4d4aae77"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#aa3f2d472e4431e52438a646a4d4aae77">ChetoRp.Database.DbTransaction.DbTransaction</a></div><div class="ttdeci">static DbTransaction()</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00014">DbTransaction.cs:14</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_adad7a05733a157d92f153556e8ab59d8"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#adad7a05733a157d92f153556e8ab59d8">ChetoRp.Database.DbTransaction.stepId</a></div><div class="ttdeci">ulong stepId</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00012">DbTransaction.cs:12</a></div></div>
<div class="ttc" id="aclass_cheto_rp_1_1_database_1_1_db_transaction_html_af67548bcb86a4434a9f2e307b64a7a20"><div class="ttname"><a href="class_cheto_rp_1_1_database_1_1_db_transaction.html#af67548bcb86a4434a9f2e307b64a7a20">ChetoRp.Database.DbTransaction.Commit</a></div><div class="ttdeci">void Commit()</div><div class="ttdef"><b>Definition:</b> <a href="_db_transaction_8cs_source.html#l00089">DbTransaction.cs:89</a></div></div>
<div class="ttc" id="anamespace_cheto_rp_1_1_database_html"><div class="ttname"><a href="namespace_cheto_rp_1_1_database.html">ChetoRp.Database</a></div><div class="ttdef"><b>Definition:</b> <a href="_add_query_type_8cs_source.html#l00001">AddQueryType.cs:2</a></div></div>
<div class="ttc" id="anamespace_cheto_rp_1_1_database_html_a7f43c437a9c94b1ea086306670612e4b"><div class="ttname"><a href="namespace_cheto_rp_1_1_database.html#a7f43c437a9c94b1ea086306670612e4b">ChetoRp.Database.RemoveQueryType</a></div><div class="ttdeci">RemoveQueryType</div><div class="ttdoc">The query type enum for removing existing database entries.</div><div class="ttdef"><b>Definition:</b> <a href="_remove_query_type_8cs_source.html#l00006">RemoveQueryType.cs:7</a></div></div>
<div class="ttc" id="anamespace_cheto_rp_1_1_database_html_aa0b504dd3da40bdfaaafd72a2f0c4885"><div class="ttname"><a href="namespace_cheto_rp_1_1_database.html#aa0b504dd3da40bdfaaafd72a2f0c4885">ChetoRp.Database.AddQueryType</a></div><div class="ttdeci">AddQueryType</div><div class="ttdoc">The query type enum for adding or mutating existing database entries.</div><div class="ttdef"><b>Definition:</b> <a href="_add_query_type_8cs_source.html#l00006">AddQueryType.cs:7</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_050edd66366d13764f98250ef6db77f6.html">code</a></li><li class="navelem"><a class="el" href="dir_d6b621d30da8631e8400901f931fdb53.html">Util</a></li><li class="navelem"><a class="el" href="dir_29d0a515d166dbb584bd1ff2b906349c.html">Database</a></li><li class="navelem"><a class="el" href="_db_transaction_8cs.html">DbTransaction.cs</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
